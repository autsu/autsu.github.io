<!DOCTYPE html>
<html
  lang="zh"
  dir="ltr"
  
><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Linux è™šæ‹Ÿç½‘ç»œè®¾å¤‡ Veth-Pair [æœªå®Œ] | /dev/null</title>

<meta name="generator" content="Hugo Eureka 0.9.3" />
<link rel="stylesheet" href="/css/eureka.min.9cec6350e37e534b0338fa9a085bf06855de3b0f2dcf857e792e5e97b07ea905d4d5513db554cbc26a9c3da622bae92d.css">
<script defer src="/js/eureka.min.fa9a6bf6d7a50bb635b4cca7d2ba5cf3dfb095ae3798773f1328f7950028b48c17d06276594e1b5f244a25a6c969a705.js"></script>













<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload"
  href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&amp;family=Noto&#43;Serif&#43;SC:wght@400;600;700&amp;display=swap"
  as="style" onload="this.onload=null;this.rel='stylesheet'">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/atom-one-dark.min.css"
   media="print"
  onload="this.media='all';this.onload=null" crossorigin>
<script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js"
   crossorigin></script>
  <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/python.min.js"
     crossorigin></script>
<link rel="stylesheet" href="/css/highlightjs.min.2958991528e43eb6fc9b8c4f2b8e052f79c4010718e1d1e888a777620e9ee63021c2c57ec7417a3108019bb8c41943e6.css" media="print" onload="this.media='all';this.onload=null">


<script defer type="text/javascript" src="/js/fontawesome.min.7ecdf591e18d9b7d9a9acfee01f5545be9b15d3fb9a6235fc83f0f7b48df77c7d3fd123037395d75224bf17af86143c1.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"
   integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ"  media="print"
  onload="this.media='all';this.onload=null" crossorigin>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js" 
  integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY"  crossorigin></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js"
   integrity="sha384-&#43;XBljXPPiv&#43;OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR"  crossorigin></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
        { left: "\\(", right: "\\)", display: false },
        { left: "\\[", right: "\\]", display: true }
      ],
    });
  });
</script>


<script defer src="https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js" 
  integrity="sha384-atOyb0FxAgN9LyAc6PEf9BjgwLISyansgdH8/VXQH8p2o5vfrRgmGIJ2Sg22L0A0"  crossorigin></script>
<link rel="preconnect" href="https://www.google-analytics.com" crossorigin>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-80J26VFWFL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-80J26VFWFL');
</script>

<meta name="referrer" content="no-referrer" />
<style>
    .search-container {
    margin-top: -0.3rem;
    }
    .search-container .search {
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    }
    .search-container input {
    padding-left: 1rem;
    line-height: 2rem;
    outline: none;
    background: transparent;
    }
    .search-container button {
    font-size: 0.8rem;
    margin-right: 0.5rem;
    color: #e2e8f0;
    }

     
    .categories-card {
    margin: 0 auto;
     
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-direction: row;
    flex-wrap: wrap;
    line-height: 1.6rem;
    }

    .categories-card .card-item {
    font-size: .875rem;
    text-align: left;
    width: 45%;
    display: flex;
    align-items: flex-start;
    margin-top: 2rem;
    min-height: 10rem;
    padding: 0 2%;
    position: relative;
    }

    .categories-card .card-item .card-item-wrapper {
    width: 100%;
    overflow: hidden;
    }

    .categories-card .card-item .card-item-wrapper .card-item-title {
    font-size: 1.2rem;
    font-weight: bold;
    display: inline-block;
    margin-top: 1rem;
    margin-bottom: .75rem;
    }

    .categories-card .card-item .card-item-wrapper span {
    float: right;
    padding-right: 1rem;
    }

    .archive-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-sizing: border-box;
    margin: .25rem 0 .25rem 1.5rem;
    }

    .more-post {
    text-align: right;
    }
    .tag-cloud-tags {
    margin: 10px 0;
    }

    .tag-cloud-tags a {
    display: inline-block;
    position: relative;
    margin: 5px 10px;
    }
    
    .archive .single-title {
    text-align: right;
    }

    .archive .group-title {
    margin-top: 1.5rem;
    margin-bottom: 1rem;
    }
    .archive .archive-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-sizing: border-box;
    margin: 0.25rem 0 0.25rem 1.5rem;
    }
     

</style>
<script src="/fontawesome/js/all.min.js"></script>
<link rel="icon" type="image/png" sizes="32x32" href="/images/icon_hu64421c6c7700f606f0ad45d807017b09_5843_32x32_fill_box_center_3.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/icon_hu64421c6c7700f606f0ad45d807017b09_5843_180x180_fill_box_center_3.png">

<meta name="description"
  content="ä»‹ç» Veth-Pair æ˜¯ä»€ä¹ˆ é¡¾åæ€ä¹‰ï¼ŒVeth-Pair å°±æ˜¯ä¸€å¯¹çš„è™šæ‹Ÿè®¾å¤‡æ¥å£ï¼Œå®ƒæ€»æ˜¯ä»¥ä¸¤å¼ è™šæ‹Ÿç½‘å¡ï¼ˆVeth Peerï¼‰æˆå¯¹å‡ºç°ï¼Œæ¯ä¸ª Veth éƒ½æœ‰ä¸¤ç«¯ï¼Œå…¶ä¸­ä¸€ç«¯è¿ç€ç½‘ç»œåè®®æ ˆï¼Œå¦ä¸€ç«¯è¿æ¥å¦ä¸€ä¸ª Vethã€‚æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¯¥ Veth-Pair æœ‰ä¸¤å¼ è™šæ‹Ÿç½‘å¡ veth0 å’Œ veth1ï¼Œå®ƒä»¬å½¼æ­¤ç›¸è¿ï¼Œæ­¤å¤–æ¯ä¸ªè™šæ‹Ÿç½‘å¡éƒ½è¿˜è¿æ¥ç€ç½‘ç»œåè®®æ ˆã€‚">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
      "@type": "ListItem",
      "position": 1 ,
      "name":"æ–‡ç« ",
      "item":"/posts/"},{
      "@type": "ListItem",
      "position": 2 ,
      "name":"Linux è™šæ‹Ÿç½‘ç»œè®¾å¤‡ Veth-Pair [æœªå®Œ]",
      "item":"/posts/linux_veth_pair/"}]
}
</script>



<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/posts/linux_veth_pair/"
    },
    "headline": "Linux è™šæ‹Ÿç½‘ç»œè®¾å¤‡ Veth-Pair [æœªå®Œ] | \/dev\/null","datePublished": "2022-09-06T22:37:45+00:00",
    "dateModified": "2022-09-06T22:37:45+00:00",
    "wordCount":  1050 ,
    "publisher": {
        "@type": "Person",
        "name": "void",
        "logo": {
            "@type": "ImageObject",
            "url": "/images/icon.png"
        }
        },
    "description": "ä»‹ç» Veth-Pair æ˜¯ä»€ä¹ˆ é¡¾åæ€ä¹‰ï¼ŒVeth-Pair å°±æ˜¯ä¸€å¯¹çš„è™šæ‹Ÿè®¾å¤‡æ¥å£ï¼Œå®ƒæ€»æ˜¯ä»¥ä¸¤å¼ è™šæ‹Ÿç½‘å¡ï¼ˆVeth Peerï¼‰æˆå¯¹å‡ºç°ï¼Œæ¯ä¸ª Veth éƒ½æœ‰ä¸¤ç«¯ï¼Œå…¶ä¸­ä¸€ç«¯è¿ç€ç½‘ç»œåè®®æ ˆï¼Œå¦ä¸€ç«¯è¿æ¥å¦ä¸€ä¸ª Vethã€‚æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¯¥ Veth-Pair æœ‰ä¸¤å¼ è™šæ‹Ÿç½‘å¡ veth0 å’Œ veth1ï¼Œå®ƒä»¬å½¼æ­¤ç›¸è¿ï¼Œæ­¤å¤–æ¯ä¸ªè™šæ‹Ÿç½‘å¡éƒ½è¿˜è¿æ¥ç€ç½‘ç»œåè®®æ ˆã€‚"
}
</script><meta property="og:title" content="Linux è™šæ‹Ÿç½‘ç»œè®¾å¤‡ Veth-Pair [æœªå®Œ] | /dev/null" />
<meta property="og:type" content="article" />


<meta property="og:image" content="/images/icon.png">


<meta property="og:url" content="/posts/linux_veth_pair/" />




<meta property="og:description" content="ä»‹ç» Veth-Pair æ˜¯ä»€ä¹ˆ é¡¾åæ€ä¹‰ï¼ŒVeth-Pair å°±æ˜¯ä¸€å¯¹çš„è™šæ‹Ÿè®¾å¤‡æ¥å£ï¼Œå®ƒæ€»æ˜¯ä»¥ä¸¤å¼ è™šæ‹Ÿç½‘å¡ï¼ˆVeth Peerï¼‰æˆå¯¹å‡ºç°ï¼Œæ¯ä¸ª Veth éƒ½æœ‰ä¸¤ç«¯ï¼Œå…¶ä¸­ä¸€ç«¯è¿ç€ç½‘ç»œåè®®æ ˆï¼Œå¦ä¸€ç«¯è¿æ¥å¦ä¸€ä¸ª Vethã€‚æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¯¥ Veth-Pair æœ‰ä¸¤å¼ è™šæ‹Ÿç½‘å¡ veth0 å’Œ veth1ï¼Œå®ƒä»¬å½¼æ­¤ç›¸è¿ï¼Œæ­¤å¤–æ¯ä¸ªè™šæ‹Ÿç½‘å¡éƒ½è¿˜è¿æ¥ç€ç½‘ç»œåè®®æ ˆã€‚" />




<meta property="og:locale" content="zh" />




<meta property="og:site_name" content="/dev/null" />






<meta property="article:published_time" content="2022-09-06T22:37:45&#43;00:00" />


<meta property="article:modified_time" content="2022-09-06T22:37:45&#43;00:00" />



<meta property="article:section" content="posts" />


<meta property="article:tag" content="linux" />





<meta property="og:see_also" content="/posts/gu_er_jin_cheng_he_jiang_shi_jin_cheng/" />

<meta property="og:see_also" content="/posts/iptables/" />

<meta property="og:see_also" content="/posts/linux-clone-de-keng/" />

<meta property="og:see_also" content="/posts/linux-pi-liang-kill-jin-cheng/" />

<meta property="og:see_also" content="/posts/linux-gao-xing-neng-fu-wu-qi-bian-cheng-yue-du-bi-ji-di-wu-zhang-linux-wang-luo-bian-cheng-ji-chu-api/" />

<meta property="og:see_also" content="/posts/2021-1-19-soft-hard-link/" />




  <body class="flex min-h-screen flex-col">
    <header
      class="min-h-16 pl-scrollbar bg-secondary-bg fixed z-50 flex w-full items-center shadow-sm"
    >
      <div class="mx-auto w-full max-w-screen-xl"><script>
    let storageColorScheme = localStorage.getItem("lightDarkMode")
    if (((storageColorScheme == 'Auto' || storageColorScheme == null) && window.matchMedia("(prefers-color-scheme: dark)").matches) || storageColorScheme == "Dark") {
        document.getElementsByTagName('html')[0].classList.add('dark')
    }
</script>
<nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0">
    <a href="/" class="me-6 text-primary-text text-xl font-bold">/dev/null</a>
    <button id="navbar-btn" class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
        <i class="fas fa-bars"></i>
    </button>

    <div id="target"
        class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20">
        <div class="md:flex md:h-16 text-sm md:grow pb-4 md:pb-0 border-b md:border-b-0">
            <a href="/#about" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  border-transparent  me-4">å…³äº</a>
            <a href="/posts/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  selected-menu-item  me-4">æ–‡ç« </a>
            <a href="/tags/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  border-transparent  me-4">æ ‡ç­¾</a>
            <a href="/categories/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  border-transparent  me-4">åˆ†ç±»</a>
            <a href="/archive/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  border-transparent  me-4">å½’æ¡£</a>
        </div>

        <div class="flex">
            
            <div class="search-container relative pt-4 md:pt-0">
                <div class="search">
                    <form role="search" class="search-form" action="/search" method="get">
                    <label>
                        <input name="q" type="text" placeholder="æœç´¢ ..." class="search-field">
                    </label>
                    <button>
                        <i class="fas fa-search"></i>
                    </button>
                    </form>
                </div>
            </div>


            <div class="relative pt-4 md:pt-0" style="margin-left: 1rem">
                <div class="cursor-pointer hover:text-eureka" id="lightDarkMode">
                    <i class="fas fa-adjust"></i>
                </div>
                <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id="is-open">
                </div>
                <div class="absolute flex flex-col start-0 md:start-auto end-auto md:end-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40"
                    id='lightDarkOptions'>
                    <span class="px-4 py-1 hover:text-eureka" name="Light">æµ…è‰²</span>
                    <span class="px-4 py-1 hover:text-eureka" name="Dark">æ·±è‰²</span>
                    <span class="px-4 py-1 hover:text-eureka" name="Auto">è‡ªåŠ¨</span>
                </div>
            </div>

            
        </div>
    </div>

    <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id="is-open-mobile">
    </div>

</nav>
<script>
    
    let element = document.getElementById('lightDarkMode')
    if (storageColorScheme == null || storageColorScheme == 'Auto') {
        document.addEventListener('DOMContentLoaded', () => {
            window.matchMedia("(prefers-color-scheme: dark)").addEventListener('change', switchDarkMode)
        })
    } else if (storageColorScheme == "Light") {
        element.firstElementChild.classList.remove('fa-adjust')
        element.firstElementChild.setAttribute("data-icon", 'sun')
        element.firstElementChild.classList.add('fa-sun')
    } else if (storageColorScheme == "Dark") {
        element.firstElementChild.classList.remove('fa-adjust')
        element.firstElementChild.setAttribute("data-icon", 'moon')
        element.firstElementChild.classList.add('fa-moon')
    }

    document.addEventListener('DOMContentLoaded', () => {
        getcolorscheme();
        switchBurger();
    });
</script>
</div>
    </header>
    <main class="grow pt-16">
        <div class="pl-scrollbar">
          <div class="mx-auto w-full max-w-screen-xl lg:px-4 xl:px-8">
  
  
  <div class="grid grid-cols-2 gap-4 lg:grid-cols-8 lg:pt-12">
    <div
      class=" bg-secondary-bg col-span-2 rounded px-6 py-8 lg:col-span-6"
    >
      <article class="prose">
  <h1 class="mb-4">Linux è™šæ‹Ÿç½‘ç»œè®¾å¤‡ Veth-Pair [æœªå®Œ]</h1>

  <div
  class="text-tertiary-text not-prose mt-2 flex flex-row flex-wrap items-center"
>
  <div class="me-6 my-2">
    <i class="fas fa-calendar me-1"></i>
    <span
      >2022-09-06</span
    >
  </div>
  <div class="me-6 my-2">
    <i class="fas fa-clock me-1"></i>
    <span>5åˆ†é’Ÿé˜…è¯»æ—¶é•¿</span>
  </div>

  

  
</div>


  
  

  <h1 id="ä»‹ç»">ä»‹ç»</h1>
<h2 id="veth-pair-æ˜¯ä»€ä¹ˆ">Veth-Pair æ˜¯ä»€ä¹ˆ</h2>
<p>é¡¾åæ€ä¹‰ï¼ŒVeth-Pair å°±æ˜¯ä¸€å¯¹çš„è™šæ‹Ÿè®¾å¤‡æ¥å£ï¼Œå®ƒæ€»æ˜¯ä»¥ä¸¤å¼ è™šæ‹Ÿç½‘å¡ï¼ˆVeth Peerï¼‰<strong>æˆå¯¹å‡ºç°</strong>ï¼Œæ¯ä¸ª Veth éƒ½æœ‰ä¸¤ç«¯ï¼Œå…¶ä¸­ä¸€ç«¯è¿ç€ç½‘ç»œåè®®æ ˆï¼Œå¦ä¸€ç«¯è¿æ¥å¦ä¸€ä¸ª Vethã€‚æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¯¥ Veth-Pair æœ‰ä¸¤å¼ è™šæ‹Ÿç½‘å¡ <code>veth0</code> å’Œ <code>veth1</code>ï¼Œå®ƒä»¬å½¼æ­¤ç›¸è¿ï¼Œæ­¤å¤–æ¯ä¸ªè™šæ‹Ÿç½‘å¡éƒ½è¿˜è¿æ¥ç€ç½‘ç»œåè®®æ ˆã€‚</p>
<pre><code>---------------------------------------------
|                                           |
|               ç½‘ç»œåè®®æ ˆ                    |
|                                           |
---------------------------------------------
    ^             ^               ^
    |             |               |
    |             |               |
    |         ---------       ---------	
    |         | veth0 |       | veth1 |
--------      ---------       ---------
| eth0 |          ^	              ^
--------          |               |	
                  |               |
                   ---------------
</code></pre>
<p>ææ¸…æ¥š Veth-Pair çš„å¤§è‡´æ¦‚å¿µäº†ï¼Œæ¥ä¸‹æ¥éœ€è¦äº†è§£ä¸€ä¸‹ Veth-Pair çš„ä½œç”¨ï¼Œå…¶å®ä»ä¸Šé¢çš„å›¾ä¸­å·²ç»å¯ä»¥å¤§è‡´çŒœåˆ°äº†ï¼Œæ—¢ç„¶è¿™äº›ä¸œè¥¿éƒ½è¿åœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆä¸€å®šå’Œæ•°æ®ä¼ è¾“è„±ä¸äº†å…³ç³»ï¼Œå®é™…ä¸Šç¡®å®å¦‚æ­¤ï¼Œå¯¹äº Veth-Pair è€Œè¨€ï¼Œä»å…¶ä¸­ä¸€å¼ è™šæ‹Ÿç½‘å¡å‘å‡ºçš„æ•°æ®åŒ…ï¼Œå¯ä»¥è¢«å¦ä¸€å¼ è™šæ‹Ÿç½‘å¡æ¥æ”¶åˆ°ï¼Œè€Œæ¯å¼ è™šæ‹Ÿç½‘å¡åˆéƒ½è¿æ¥åˆ°äº†ç½‘ç»œåè®®æ ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒVeth-Pair å¯ä»¥å……å½“ç½‘ç»œåè®®æ ˆä¸­æŸäº›æ¥å£è®¾å¤‡ä¼ é€’æ•°æ®çš„æ¡¥æ¢ã€‚</p>
<h1 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h1>
<h2 id="ä¸¤ä¸ª-namespace-é—´é€šä¿¡">ä¸¤ä¸ª namespace é—´é€šä¿¡</h2>
<h3 id="ç›´æ¥è¿æ¥">ç›´æ¥è¿æ¥</h3>
<p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªç½‘ç»œ namespaceï¼Œç„¶åå†åˆ›å»ºä¸€å¯¹ Veth-Pairï¼Œå¹¶ä¸”ç»™è¯¥ Veth-Pair çš„ä¸¤ä¸ªè™šæ‹Ÿç½‘å¡åˆ†é… IP åœ°å€ï¼Œæœ€åï¼Œå°†è¿™ä¸¤ä¸ªè™šæ‹Ÿç½‘å¡åˆ†é…ç»™ä¸¤ä¸ª namespaceã€‚</p>
<pre><code class="language-shell"># åˆ›å»º 2 ä¸ª namespace
ip netns add ns1
ip netns add ns2

# æŸ¥çœ‹åˆ›å»ºçš„ namespace
ip netns
ns2
ns1

# åˆ›å»ºä¸€å¯¹ veth-pairï¼Œåˆ†åˆ«å‘½åä¸º veth0 veth1
ip l a veth0 type veth peer name veth1
# ä¹Ÿå¯ä»¥å†™æˆï¼š
# ip link add veth0 type veth peer name veth1

# å°† veth0 veth1 åˆ†åˆ«åŠ å…¥ä¸¤ä¸ª ns
ip l s veth0 netns ns1
ip l s veth1 netns ns2

# ç»™ä¸¤ä¸ªè™šæ‹Ÿç½‘å¡ veth0 veth1 é…ä¸Š IP å¹¶å¯ç”¨
ip netns exec ns1 ip a a 10.1.1.2/24 dev veth0
ip netns exec ns1 ip l s veth0 up
ip netns exec ns2 ip a a 10.1.1.3/24 dev veth1
ip netns exec ns2 ip l s veth1 up
</code></pre>
<p>æ·»åŠ å®Œåå¯ä»¥çœ‹ä¸€ä¸‹æ¯ä¸ª namespace çš„ç½‘å¡è®¾å¤‡ï¼š</p>
<pre><code class="language-shell">$ ip netns exec ns1 ip addr
1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
5: veth0@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 4a:19:b1:f3:af:22 brd ff:ff:ff:ff:ff:ff link-netns ns2
    inet 10.1.1.2/24 scope global veth0
       valid_lft forever preferred_lft forever
    inet6 fe80::4819:b1ff:fef3:af22/64 scope link
       valid_lft forever preferred_lft forever
    
$ ip netns exec ns2 ip addr
1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
4: veth1@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether be:61:8a:3f:eb:b2 brd ff:ff:ff:ff:ff:ff link-netns ns1
    inet 10.1.1.3/24 scope global veth1
       valid_lft forever preferred_lft forever
    inet6 fe80::bc61:8aff:fe3f:ebb2/64 scope link
       valid_lft forever preferred_lft forever
</code></pre>
<p>å¯ä»¥çœ‹åˆ°æ¯ä¸ª namespace éƒ½æœ‰ä¸€å¼ ä»¥ veth å¼€å¤´çš„ç½‘å¡ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬åˆ›å»ºçš„ Veth-Pair çš„ä¸¤å¼ è™šæ‹Ÿç½‘å¡ <code>veth0</code> å’Œ <code>veth1</code>ï¼Œå¹¶ä¸”æ¯å¼ ç½‘å¡æ‹¥æœ‰ä¸€ä¸ª IPã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ç±»ä¼¼æ–‡ç« å¼€å¤´ä»‹ç»ä¸­çš„å›¾ç‰‡çš„ç»“æ„ï¼šveth0 å’Œ veth1 ç›¸äº’è¿æ¥ï¼Œç„¶å veth0 åˆè¿æ¥ç€ ns1ï¼Œveth1 åˆè¿æ¥ç€ ns2ï¼š</p>
<pre><code>              ---------       ---------
              |  ns1  |       |  ns2  |
              ---------       ---------    
                  ^               ^
                  |               |
                  |               |
              ---------       ---------	
              | veth0 |       | veth1 |
              ---------       ---------
                  ^	              ^
                  |               |	
                  |               |
                   ---------------
</code></pre>
<p>ç°åœ¨ï¼Œä¸¤ä¸ªæœ¬æ¥ç›¸äº’éš”ç¦»ï¼Œå„è‡ªæ‹¥æœ‰ç‹¬ç«‹ç½‘ç»œåè®®æ ˆï¼Œåƒå­¤å²›ä¸€æ ·çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œé€šè¿‡ Veth-Pair è¿™ä¸ªâ€œæ¡¥æ¢â€ï¼Œæ­£å¼å»ºç«‹èµ·äº†å½¼æ­¤æ²Ÿé€šçš„æ¸ é“ã€‚è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ï¼Œç”¨ ns1 å» ping ns2ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ ping é€šï¼š</p>
<pre><code class="language-shell"># ä» veth0 ping veth1
$ ip netns exec ns1 ping 10.1.1.3
PING 10.1.1.3 (10.1.1.3) 56(84) bytes of data.
64 bytes from 10.1.1.3: icmp_seq=1 ttl=64 time=0.997 ms
64 bytes from 10.1.1.3: icmp_seq=2 ttl=64 time=0.102 ms
64 bytes from 10.1.1.3: icmp_seq=3 ttl=64 time=0.063 ms
^C
--- 10.1.1.3 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2026ms
rtt min/avg/max/mdev = 0.063/0.387/0.997/0.431 ms
</code></pre>
<p>å¯ä»¥çœ‹åˆ° ping èƒ½æ­£å¸¸å·¥ä½œï¼Œè¯´æ˜äºŒè€…å·²ç»å¯ä»¥é€šä¿¡äº†ã€‚</p>
<h3 id="é€šè¿‡-bridge-ç›¸è¿">é€šè¿‡ Bridge ç›¸è¿</h3>
<p>ä¸Šé¢ <strong>ç›´æ¥è¿æ¥</strong> çš„ demo ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€å¯¹ Veth-Pair è®©ä¸¤ä¸ª namespace ä¹‹é—´å®ç°äº†é€šä¿¡ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è®©ä¸‰ä¸ªï¼Œå››ä¸ªï¼Œç”šè‡³æ›´å¤šçš„ namespace ä¹‹é—´éƒ½èƒ½å¤Ÿé€šä¿¡å‘¢ï¼Ÿè¦è¿˜æ˜¯é‡‡ç”¨ç›´æ¥è¿æ¥çš„æ–¹å¼ï¼Œé‚£å¯å°±å¤ªå¤æ‚äº†ï¼Œæ¯”å¦‚å¦‚æœæœ‰å››ä¸ª namespaceï¼Œåˆ†åˆ«æ˜¯ ns1ï¼Œns2ï¼Œns3ï¼Œns4ï¼Œé‚£ä¹ˆ ns1 å’Œ ns2 é€šä¿¡éœ€è¦ä¸€å¯¹ Veth-Pairï¼Œns1 å’Œ ns3ï¼Œns1 å’Œ ns4ï¼Œns2 å’Œ ns3ï¼Œns2 å’Œ ns4ï¼Œns3 å’Œ ns4 éƒ½éœ€è¦ä¸€å¯¹ Veth-Pairã€‚ã€‚ã€‚æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p>
<p>è§£å†³åŠæ³•å°±æ˜¯å¼•å…¥ä¸€ä¸ªæ–°çš„ç½‘ç»œè®¾å¤‡ï¼šèƒ½å¤Ÿèµ·åˆ°è™šæ‹Ÿäº¤æ¢æœºä½œç”¨çš„ <strong>ç½‘æ¡¥</strong>ï¼Œå®ƒæ˜¯ä¸€ä¸ªåœ¨ <strong>æ•°æ®é“¾è·¯å±‚</strong> å·¥ä½œçš„è®¾å¤‡ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ® MAC åœ°å€å­¦ä¹ å°†æ•°æ®åŒ…è½¬å‘åˆ°ç½‘æ¡¥çš„ä¸åŒç«¯å£ä¸Šã€‚</p>
<blockquote>
<p>çªå‡»æµ‹è¯•ï¼šä»€ä¹ˆæ˜¯ MAC åœ°å€å­¦ä¹ ï¼Ÿ</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Veth-Pairï¼Œå°†å„ä¸ª namespace ä¸ç½‘æ¡¥è¿æ¥èµ·æ¥ï¼Œè¿™äº› namespace å…¨éƒ¨éƒ½åŠ å…¥åˆ°åŒä¸€ä¸ªç½‘æ¡¥ï¼Œç›¸å½“äºéƒ½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ä¸‹ï¼Œæ‰€ä»¥å½¼æ­¤ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ã€‚</p>
<blockquote>
<p>ğŸ¤” è¿™äº›è™šæ‹Ÿç½‘å¡ï¼ˆè¿æ¥åˆ° namespace è¿™ä¸€ç«¯çš„ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­çš„ veth0ï¼Œveth1ï¼Œveth2ï¼Œveth3ï¼‰çš„ IP æ˜¯å¦å¿…é¡»è¦å¤„äºåŒä¸€ç½‘æ®µï¼Ÿå¦åˆ™å³ä½¿éƒ½åœ¨åŒä¸€ä¸ªç½‘æ¡¥ï¼Œä¹Ÿæ— æ³•è¿›è¡Œé€šä¿¡ï¼Ÿ</p>
<p>ğŸ“¢ å¦‚æœä¸¤ä¸ªç½‘å¡çš„IPä¸åœ¨åŒä¸€ä¸ªå­ç½‘ï¼Œå°†å®ƒä»¬åŠ å…¥åˆ°åŒä¸€ä¸ªç½‘æ¡¥åï¼Œå®ƒä»¬åœ¨ç½‘ç»œå±‚ï¼ˆIPå±‚ï¼‰ä»ç„¶æ— æ³•ç›´æ¥é€šä¿¡ã€‚è¿™æ˜¯å› ä¸ºç½‘æ¡¥å·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ï¼Œå®ƒåªè´Ÿè´£æ ¹æ®MACåœ°å€è½¬å‘æ•°æ®åŒ…ï¼Œå¹¶ä¸æ¶‰åŠIPåœ°å€çš„è·¯ç”±ã€‚</p>
<p>å¾…å®è·µ</p>
</blockquote>
<p>æ‹“æ‰‘ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code>              ---------       ---------    ---------    ---------
              |  ns1  |       |  ns2  |    |  ns3  |    |  ns4  | 
              ---------       ---------    ---------    ---------   
                  ^               ^            ^            ^
                  |               |            |            |
                  |               |            |            |
              ---------       ---------	   ---------    ---------
              | veth0 |       | veth1 |    | veth2 |    | veth3 |
              ---------       ---------    ---------    ---------
                  ^	              ^            ^            ^
                  |               |	           |            |
                  |               |            |            |
                  âˆ¨               âˆ¨            âˆ¨            âˆ¨
              -----------     ------------  ------------  ------------
              | br-veth0 |    | br-veth1 |  | br-veth2 |  | br-veth3 |
              -----------     ------------  ------------  ------------
                  ^	              ^               ^            ^
                  |               |	              |            |
                  |               |               |            |
                  âˆ¨               âˆ¨               âˆ¨            âˆ¨
              ------------------------------------------------------
              |                       ç½‘æ¡¥                          |
              ------------------------------------------------------
</code></pre>
<p>å®è·µï¼š</p>
<pre><code class="language-shell"># é¦–å…ˆåˆ›å»º bridge br0
ip l a br0 type bridge
ip l s br0 up 

# å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹åˆ›å»ºå‡ºæ¥çš„ç½‘æ¡¥
ip link show type bridge

# ç„¶åæˆ‘ä»¬åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šï¼Œå†åˆ›å»ºä¸¤ä¸ª namespace
ip netns add ns3
ip netns add ns4

# ç„¶ååˆ›å»º 4 å¯¹æ–°çš„ veth-pair
ip l a veth2 type veth peer name br-veth2
ip l a veth3 type veth peer name br-veth3
ip l a veth4 type veth peer name br-veth4
ip l a veth5 type veth peer name br-veth5

# å°†è¿™ 4 å¯¹ veth-pair åŠ å…¥åˆ° ns å’Œ br0
ip l s veth2 netns ns1
ip l s br-veth2 master br0
ip l s br-veth2 up

ip l s veth3 netns ns2
ip l s br-veth3 master br0
ip l s br-veth3 up

ip l s veth4 netns ns3
ip l s br-veth4 master br0
ip l s br-veth4 up

ip l s veth5 netns ns4
ip l s br-veth5 master br0
ip l s br-veth5 up

# ç»™ veth é…ç½® IP å¹¶å¯ç”¨
ip netns exec ns1 ip a a 10.1.2.2/24 dev veth2
ip netns exec ns1 ip l s veth2 up

ip netns exec ns2 ip a a 10.1.2.3/24 dev veth3
ip netns exec ns2 ip l s veth3 up

ip netns exec ns3 ip a a 10.1.2.4/24 dev veth4
ip netns exec ns3 ip l s veth4 up

ip netns exec ns4 ip a a 10.1.2.5/24 dev veth5
ip netns exec ns4 ip l s veth5 up
</code></pre>
<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹å„ä¸ª namespace çš„ç½‘å¡æƒ…å†µï¼š</p>
<pre><code class="language-shell">$ ip netns exec ns1 ip addr
1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
5: veth0@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 4a:19:b1:f3:af:22 brd ff:ff:ff:ff:ff:ff link-netns ns2
    inet 10.1.1.2/24 scope global veth0
       valid_lft forever preferred_lft forever
    inet6 fe80::4819:b1ff:fef3:af22/64 scope link
       valid_lft forever preferred_lft forever
12: veth2@if11: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 0e:24:20:80:09:97 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.1.2.2/24 scope global veth2
       valid_lft forever preferred_lft forever
    inet6 fe80::c24:20ff:fe80:997/64 scope link
       valid_lft forever preferred_lft forever
       
$ ip netns exec ns3 ip addr
1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
16: veth4@if15: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 9e:84:97:27:44:c4 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.1.2.4/24 scope global veth4
       valid_lft forever preferred_lft forever
    inet6 fe80::9c84:97ff:fe27:44c4/64 scope link
       valid_lft forever preferred_lft forever
</code></pre>
<p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿åªæŸ¥çœ‹äº† ns1 å’Œ ns3 è¿™ä¸¤ä¸ª namespace çš„æƒ…å†µï¼Œå› ä¸º ns1 è¿™ä¸ª namespace æ˜¯ä¹‹å‰åˆ›å»ºå¥½çš„ï¼Œåœ¨å…¶åŸºç¡€ä¸Šåˆæ’å…¥äº†ä¸€ä¸ª Vethï¼Œæ‰€ä»¥æœ‰ veth0 å’Œ veth2 ä¸¤å¼ ç½‘å¡ï¼Œè€Œ ns3 æ˜¯æ–°åˆ›å»ºçš„ï¼Œæ‰€ä»¥åªæœ‰ veth4 è¿™ä¸€å¼ ç½‘å¡ï¼ˆlo ä»£è¡¨å›ç¯ç½‘å¡ï¼Œä¸æœ¬æ¬¡å®éªŒæ— å…³ï¼Œå¯ä»¥å¿½ç•¥ï¼‰ã€‚</p>
<p>ç„¶åæˆ‘ä»¬éªŒè¯ä¸€ä¸‹è¿™å‡ ä¸ª namespace ä¹‹é—´çš„è¿é€šæƒ…å†µï¼š</p>
<pre><code class="language-shell">ip netns exec ns4 ping 10.1.2.2
ip netns exec ns4 ping 10.1.2.3
ip netns exec ns4 ping 10.1.2.4
# .... å°±ä¸å…¨éƒ¨æµ‹è¯•äº†ï¼Œæµ‹è¿‡çš„éƒ½å¯ä»¥ ping é€š
</code></pre>
<h1 id="å‚è€ƒ">å‚è€ƒ</h1>
<p><a href="https://www.cnblogs.com/bakari/p/10613710.html">https://www.cnblogs.com/bakari/p/10613710.html</a></p>
<p><a href="https://segmentfault.com/a/1190000009251098">https://segmentfault.com/a/1190000009251098</a></p>
<p><a href="https://mp.weixin.qq.com/s/dP12ptPlsxS35qPr0mDjCw">https://mp.weixin.qq.com/s/dP12ptPlsxS35qPr0mDjCw</a></p>

</article>


      
        <div class="my-4">
    
    <a href="/tags/linux/" class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#linux</a>
    
</div>
      

      



      

      
  <div
    class="-mx-2 mt-4 flex flex-col border-t px-2 pt-4 md:flex-row md:justify-between"
  >
    <div>
      
        <span class="text-primary-text block font-bold"
          >ä¸Šä¸€é¡µ</span
        >
        <a href="/posts/jetbrain_crash/" class="block">GoLand/Idea å¯åŠ¨é—ªé€€ï¼ŒæŠ¥é”™ NSInternalInconsistencyException çš„è§£å†³æ–¹æ³•</a>
      
    </div>
    <div class="mt-4 md:mt-0 md:text-right">
      
        <span class="text-primary-text block font-bold">ä¸‹ä¸€é¡µ</span>
        <a href="/posts/eof_cuo_wu/" class="block">ä¸€ä¸ª EOF å¼•å‘çš„ä½çº§é”™è¯¯</a>
      
    </div>
  </div>


      



  <div id="valine-comments" class="mt-4"></div>
<script defer src="https://cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js" 
  integrity="sha384-e0&#43;DNUCJo75aOAzHQbFWYBCM9/S4f0BhRJXvEgbE3mMS85RM20MSSGStHuNdY2QK"  crossorigin></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    new Valine({
      el: "#valine-comments",appId:"6KXGn05vaODkTMKM7zd5lWwl-gzGzoHsz",appKey:"qIMQwH4WrxTe8ds3Ua4HAbet",
    })
  });
</script>

    </div>
    
      <div class="col-span-2">
        
        
          <div
  class="
    bg-primary-bg
   prose sticky top-16 z-10 hidden px-6 py-4 lg:block"
>
  <h3>æœ¬é¡µå†…å®¹</h3>
</div>
<div
  class="sticky-toc  hidden px-6 pb-6 lg:block"
>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#ä»‹ç»">ä»‹ç»</a>
      <ul>
        <li><a href="#veth-pair-æ˜¯ä»€ä¹ˆ">Veth-Pair æ˜¯ä»€ä¹ˆ</a></li>
      </ul>
    </li>
    <li><a href="#ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</a>
      <ul>
        <li><a href="#ä¸¤ä¸ª-namespace-é—´é€šä¿¡">ä¸¤ä¸ª namespace é—´é€šä¿¡</a>
          <ul>
            <li><a href="#ç›´æ¥è¿æ¥">ç›´æ¥è¿æ¥</a></li>
            <li><a href="#é€šè¿‡-bridge-ç›¸è¿">é€šè¿‡ Bridge ç›¸è¿</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
  </ul>
</nav>
</div>
<script>
  window.addEventListener("DOMContentLoaded", () => {
    enableStickyToc();
  });
</script>

        
      </div>
    

    
    
      <div
        class=" bg-secondary-bg prose col-span-2 rounded p-6 lg:col-span-6"
      >
        <h3>ç›¸å…³</h3>
        
          <a href="/posts/gu_er_jin_cheng_he_jiang_shi_jin_cheng/" class="no-underline">å­¤å„¿è¿›ç¨‹ä¸åƒµå°¸è¿›ç¨‹</a>
          <br />
        
          <a href="/posts/iptables/" class="no-underline">linux iptables</a>
          <br />
        
          <a href="/posts/linux-clone-de-keng/" class="no-underline">linux clone() çš„å‘</a>
          <br />
        
          <a href="/posts/linux-pi-liang-kill-jin-cheng/" class="no-underline">Linux æ‰¹é‡ kill è¿›ç¨‹</a>
          <br />
        
          <a href="/posts/linux-gao-xing-neng-fu-wu-qi-bian-cheng-yue-du-bi-ji-di-wu-zhang-linux-wang-luo-bian-cheng-ji-chu-api/" class="no-underline">ã€Linux é«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‘é˜…è¯»ç¬”è®° ç¬¬äº”ç«  -- Linux ç½‘ç»œç¼–ç¨‹åŸºç¡€ api</a>
          <br />
        
          <a href="/posts/2021-1-19-soft-hard-link/" class="no-underline">ç¡¬é“¾æ¥å’Œè½¯é“¾æ¥</a>
          <br />
        
      </div>
    
  </div>

  
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        hljs.highlightAll();
      });
    </script>

          </div>
        </div>
      
    </main>
    <footer class="pl-scrollbar">
      <div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b">
    <p class="text-sm text-tertiary-text">&copy; 0000 <a>null</a>
 &middot;  Powered by the <a href="https://github.com/wangchucheng/hugo-eureka" class="hover:text-eureka">Eureka</a> theme for <a href="https://gohugo.io" class="hover:text-eureka">Hugo</a></p>
</div></div>
    </footer>
  </body>
</html>
